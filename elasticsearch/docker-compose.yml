version: '3'

services:
  logstash:
    build: ./logstash
    #image: docker.elastic.co/logstash/logstash:6.2.2
    container_name: "logstash"
    network_mode: "host"
    logging:
        driver: "${LOGGING_DRIVER:-json-file}"
    volumes:
        - ./logstash/config/pipelines.yml:/usr/share/logstash/config/pipelines.yml
        - ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml
        - ./logstash/pipeline:/usr/share/logstash/pipeline
    environment:
        XPACK_MONITORING_ENABLED: "true"
        HTTP_HOST: "0.0.0.0"
#        xpack_management_enabled: "true"
#        xpack_management_elasticsearch_url: "http://localhost:9200/"
#        xpack_management_logstash_poll_interval: "5s"
#        xpack_management_elasticsearch_username: "elasticsearch"
#        xpack_management_elasticsearch_password: "changeme"
#        xpack_management_pipeline_id: "['nfc', 'docker_logs']"
#        LS_JAVA_OPTS: "-Xmx256m -Xms256m"
#    ports:
#     - "9600:9600"



  elasticsearch:
#    build: .
    image: docker.elastic.co/elasticsearch/elasticsearch:6.2.2
#    volumes:
#      - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
#       - /media/pi/ext250/elastic_data:/usr/share/elasticsearch/data 
    container_name: "elastic"
    network_mode: "host"
    logging:
        driver: "${LOGGING_DRIVER:-json-file}"
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
#        ES_JAVA_OPTS: "-Xmx256m -Xms256m"
        discovery.type: "single-node"
#        ELASTIC_PASSWORD: "changeme"


  kibana:
    image: docker.elastic.co/kibana/kibana:6.2.2
    container_name: "kibana"
    network_mode: "host"
    logging:
        driver: "${LOGGING_DRIVER:-json-file}"

#    hostname: "kibana"
#    volumes:
#      - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
#       - /media/pi/ext250/elastic_data:/usr/share/elasticsearch/data 
    ports:
      - "5601:5601"
#    logging:
#        driver: "json-file"
    environment:
        ELASTICSEARCH_URL: "http://localhost:9200" 
#        ES_JAVA_OPTS: "-Xmx256m -Xms256m"
